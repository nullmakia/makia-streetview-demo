<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Step1 Mic Permission Only</title>
<style>
  html,body{height:100%;margin:0;font:16px/1.5 system-ui,-apple-system,"Segoe UI",sans-serif}
  main{min-height:100%;display:grid;place-items:center;padding:24px}
  .card{max-width:640px;width:100%;border:1px solid #ddd;border-radius:14px;padding:18px;box-shadow:0 8px 24px rgba(0,0,0,.06);background:#fff}
  button{padding:10px 14px;border-radius:10px;border:1px solid #111;background:#111;color:#fff;cursor:pointer}
  pre{background:#f7f7f7;border:1px solid #eee;border-radius:10px;padding:10px;white-space:pre-wrap}
  code{background:#f2f2f2;padding:2px 4px;border-radius:6px}
</style>
<main>
  <div class="card">
    <h1>ğŸ¤ Step1: ãƒã‚¤ã‚¯è¨±å¯ãƒ†ã‚¹ãƒˆ</h1>
    <p>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ <code>getUserMedia({audio:true})</code> ã‚’<strong>1å›ã ã‘</strong>å®Ÿè¡Œã—ã€è¨±å¯å¾Œã¯å³åœæ­¢ã—ã¾ã™ã€‚</p>
    <p><button id="btn">ğŸ¤ ãƒã‚¤ã‚¯æ¨©é™ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</button></p>
    <pre id="log">æº–å‚™å®Œäº†</pre>
    <ul>
      <li>HTTPS å¿…é ˆï¼ˆGitHub Pages ã¯OKï¼‰</li>
      <li>ã‚‚ã—ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒå‡ºãªã„ â†’ ãƒ–ãƒ©ã‚¦ã‚¶ã®ã€Œã‚µã‚¤ãƒˆã®è¨­å®šã€ã§ã“ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒã‚¤ã‚¯ãŒãƒ–ãƒ­ãƒƒã‚¯ã«ãªã£ã¦ã„ãªã„ã‹ç¢ºèª</li>
    </ul>
  </div>
</main>
<script>
const logEl = document.getElementById("log");
const log = (m) => logEl.textContent = m;

document.getElementById("btn").addEventListener("click", async () => {
  if (!navigator.mediaDevices?.getUserMedia) return log("æœªå¯¾å¿œï¼šgetUserMedia");
  if (!isSecureContext) return log("HTTPSã§é–‹ã„ã¦ãã ã•ã„ï¼ˆisSecureContext=falseï¼‰");

  log("ãƒã‚¤ã‚¯æ¨©é™ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸­â€¦");
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    stream.getTracks().forEach(t => t.stop());

    // Permission APIï¼ˆå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ï¼‰
    let state = "unknown";
    try {
      const p = await navigator.permissions.query({ name:"microphone" });
      state = p.state;
    } catch {}
    log(`âœ… è¨±å¯ã•ã‚Œã¾ã—ãŸï¼ˆpermissions.state=${state}ï¼‰`);
  } catch (e) {
    const n = e?.name || "Error";
    const msg =
      n === "NotAllowedError" ? "âŒ æ‹’å¦/ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆã‚µã‚¤ãƒˆè¨­å®šã§ã€ãƒã‚¤ã‚¯: è¨±å¯ã€ã¸ï¼‰" :
      n === "NotFoundError"    ? "âŒ ãƒã‚¤ã‚¯æœªæ¥ç¶š/ç„¡åŠ¹" :
      n === "NotReadableError" ? "âŒ åˆ¥ã‚¢ãƒ—ãƒªãŒãƒã‚¤ã‚¯å æœ‰ä¸­" :
      `âŒ å¤±æ•—: ${n}`;
    log(msg);
  }
});
</script>
</html>
